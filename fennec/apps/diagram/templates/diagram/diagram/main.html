{% extends "diagram/template/base.html" %}
{% load staticfiles %}
{% block ng-app %}myApp{% endblock %}
{% block title %}Diagram{% endblock %}
{% block custom-javascript %}
    <script>
        /* Run before angular.js */
        if (window.jQuery) {
            window.hideJQuery = window.jQuery;
            window.jQuery = false;
        }
    </script>
    <!-- Vendor Libs: jQuery only used for Bootstrap functionality -->
    <script src="{% static "js/angular/angular.js" %}"></script>
    <script src="{% static "js/angular/angular-route.js" %}"></script>
    <script src="{% static "js/angular/xeditable.js" %}"></script>
    <script src="{% static "js/spinjs/spin.js" %}"></script>

    <!--Javascript to the end for performance -->
    <script src="{% static "js/diagram/app.js" %}"></script>
    <script src="{% static "js/diagram/services/d3.js" %}"></script>
    <script src="{% static "js/diagram/services/diagramService.js" %}"></script>
    <script src="{% static "js/diagram/services/spinnerService.js" %}"></script>
    <script src="{% static "js/diagram/controllers/fennecCtrl.js" %}"></script>
    <script src="{% static "js/diagram/directives/fennecDiagram.js" %}"></script>

    <script src="{% static "js/diagram/state-machine.js" %}"></script>
    <script src="http://angular-ui.github.com/bootstrap/ui-bootstrap-tpls-0.4.0.js"></script>
{% endblock %}
{% block  ng-controller %}DiagramController{% endblock %}
{% block content %}


<!--Sidebar-->
<div class="fennec-sidebar">
    <div class="well sidebar-nav">
        <ul class="nav nav-list">
            <li class="nav-header">[[projectInfo.name]]</li>

            <li class="active"><a href="#"> [[activeDiagram.data.name]]</a></li>

            <li class="nav-header">Diagram</li>
            <button ng-click="saveDiagramButton()">Save diagram</button>
            <form class="form-horizontal" role="form">
                <div class="form-group">
                    <div class="col-sm-4">
                        <input class="form-control" id="inputName3" placeholder="Name" ng-model="activeDiagramEditData.data.name">
                        <button type="submit" ng-click="editDiagramButton()" class="btn btn-success">Edit</button>
                    </div>
                </div>
            </form>

            <li class="nav-header">Toolbar</li>
            <button onclick="changeState(fennecStates.new_table)">New table</button>
            <button onclick="changeState(fennecStates.select)">Select table</button>
            <button onclick="changeState(fennecStates.new_link)">New link</button>
            <button onclick="changeState(fennecStates.delete_obj)">Delete</button>
            <button onclick="innerLayout.toggle('south')">toggle Property div</button>

            <li class="nav-header" style="margin-top: 15px;">Schemas</li>
            <select ng-init="activeSchema=schemas[0].data" data-ng-options="s.data as s.data.databaseName for s in schemas" data-ng-model="activeSchema"></select>
            <form class="form-horizontal" role="form">
                <div class="form-group">
                    <div class="col-sm-4">
                        <button type="submit" ng-click="showCreateSchemaPopup()" class="btn btn-success">Add</button>
                    </div>
                </div>
            </form>
        </ul>
    </div>
</div>

<!-- Diagram -->
<div class="outer-center">

    <div class="middle-center"  >

        <div role="tabpanel">
			<ul class="nav nav-tabs" role="tablist">
				<li role="presentation" ng-repeat="tab in diagrams" ng-click="selectDiagram($index)" ng-class="{'active':selectedDiagram == $index}">
					<a data-target="#tab" aria-controls="home" role="tab" data-toggle="tab">[[tab.data.name]] <span ng-click="closeDiagram($index)"><i class="icon-remove"></i></span></a>
				</li>
				<li role="presentation" ng-click="addDiagram()">
					<a aria-controls="home" role="tab" data-toggle="tab">( + )</a>
				</li>
			</ul>
		</div>
        <div class="tab-content">
				<div role="tabpanel" class="tab-pane active" id="tab">
					 <fennec-diagram adiagram="activeDiagram.data" active-schema="activeSchema" data="diagramData"
                        stable="selectedTable" stable-foreign-keys="selectedTableForeignKeys" stable-indexes="selectedTableIndexes"></fennec-diagram>
				</div>
		</div>

  {#        TABLE COLUMNS PROPERTIES#}
        <div class="property">
          <tabset class="nav nav-tabs">
              <tab heading="Columns"> <div ng-include="'{% static 'partials/ColumnsTab.html' %}'"> </div></tab>
              <tab heading="Indexes"> <div ng-include="'{% static 'partials/IndexesTab.html' %}'"> </div></tab>
              <tab heading="Foreign Keys"><div ng-include="'{% static 'partials/ForeignKeysTab.html' %}'"></div></tab>
            </tabset>
        </div>

    </div>
    <div ng-if="isCreateSchemaPopupShown" ng-include="'{% static 'partials/SchemaPopup.html' %}'"></div>
</div>

{% endblock %}